<!DOCTYPE html> 
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7; IE=EmulateIE9"> 
    <!--[if IE]>
		<script src="js/excanvas.js"></script>
	<![endif]-->
	<script type="text/javascript" src="js/dygraph-combined.js"></script>
	<script type="text/javascript" src="data/index.js"></script>
	<script type="text/javascript">
	function plotGraph(procId){
		var procIdDisplayName = procId.substring(1);
		var chartDivId = ["memory", "classes", "threads", "compilation", "gc", "memPool"];
		var chartFuncNames = ["Mem", "Class", "Thrd", "Comp", "GC", "MemPool"];
		var chartYLabels = ["Heap Size (MB)", "# Classes", "# Threads", "Total Compilation Time (ms)",  "Collection Count, Collection Time(ms)", "Heap Size (MB)"];
		var legendLabels = ["memoryLegend", "classesLegend", "threadsLegend", "compilationLegend", "gcLegend", "memPoolLegend"];
		var titles = [procIdDisplayName + " - Memory", procIdDisplayName + " - Classes", procIdDisplayName + " - Threads", procIdDisplayName + " - Compilation", procIdDisplayName + " - Garbage Collectors", procIdDisplayName + " - Memory Pool"];
		
		for(var index in chartDivId){
			g = new Dygraph(
				document.getElementById(chartDivId[index]),
				eval(procId + chartFuncNames[index]),
				{
					"title" : titles[index],

					"xlabel" : "Time",
					"xAxisLabelWidth" : 60,
					"ylabel" : chartYLabels[index],

					"legend" : "always",

					"strokeWidth" : 3,
					"fillGraph" : false,
					"highlightCircleSize" : 3,

					"labelsDiv": legendLabels[index],

					"rollPeriod": 1,
					"showRoller": true
				}
			);
		}
	}
	</script>
	
	<style type="text/css">
		.select {
			width : 300px;
		}
		.chart{
			margin: auto;
		}
		
		.legend{
			text-align: center;
		}
		
		.reportSelection{
			width: 800px;
			margin: auto;
		}
		
		.dygraph-label {
			/* This applies to the title, x-axis label and y-axis label */
			font-family: Arial, Helvetica, sans-serif;
		}
		
		.dygraph-title {
			/* This rule only applies to the chart title */
			font-size: 20px;
			text-shadow: gray 2px 2px 2px;  /* color, delta-x, delta-y, blur radius */
		}
	</style>
	<title>jvmon charts</title>
</head>
<body>
	<h1 style="text-align: center;">JVMON PLOTTER </h1></br>
	<div class="reportSelection">
		<span id="reportsList">
			<select class="select" style="margin:10px;" onchange="getProcIds(this.value);"></select>
		</span>
		<span id="procsList">
			<select class="select" style="margin:10px;" onchange="plotGraph(this.value);"></select>
		</span></br>
		<span id="status" style="color:red;margin:10px;"></span>
	</div><br/><br/>
	
	<div class="chart" id="memory" style="width:800px; height: 400px"></div>
	<div class="legend" id="memoryLegend" ></div></br></br></br>
	
	<div class="chart" id="classes" style="width:800px; height: 400px"></div>
	<div class="legend" id="classesLegend" ></div></br></br></br>
		
	<div class="chart" id="threads" style="width:800px; height: 400px"></div>
	<div class="legend" id="threadsLegend" ></div></br></br></br>
	
	<div class="chart" id="compilation" style="width:800px; height: 400px"></div>
	<div class="legend" id="compilationLegend" ></div></br></br></br>
	
	<div class="chart" id="gc" style="width:800px; height: 400px"></div>
	<div class="legend" id="gcLegend" ></div></br></br></br>
	
	<div class="chart" id="memPool" style="width:800px; height: 400px"></div>
	<div class="legend" id="memPoolLegend" ></div>

	<script type="text/javascript">	
		
		
		var repPrefix = "<select class=\"select\" style=\"margin:10px;\" onchange=\"getProcIds(this.value);\">";
		var repSuffix = "</select>"
		var repDummy = "<option value=\"\">Select a Report..</option>";
		
		var part1 = "<option value=\"";
		var part2 = "\">";
		var part3 = "</option>";
		
		var procPrefix = "<select class=\"select\" style=\"margin:10px;\" onchange=\"plotGraph(this.value);\">";
		var procDummy = "<option value=\"\">Select a process..</option>";
		var procFailed = "<option value=\"\">No Processes</option>";
		var procSuffix = "</select>";
		
		var loadedReps ="";
		function loadJSFile(filename){
			if(loadedReps.indexOf(filename == -1)){
				var req = new XMLHttpRequest();
				req.open('GET', 'data/' + filename, false);
				req.send(null);
				if(req.status == 200) {
					loadedReps += filename;
					var head = document.getElementsByTagName('HEAD').item(0);
					var script = document.createElement( "script" );
					script.language = "javascript";
					script.type = "text/javascript";
					script.text = req.responseText;
					head.appendChild(script);
					document.getElementById("status").innerHTML = "";
				} else {
					document.getElementById("status").innerHTML = "Error - Could not find the report."
					return false;
				}
			}
			return true;
		}
		
		// starts here
		// get reports from index
		var reportsList = new Array();
		reportsList = getReportList().split(",");
		var reportsOptions = "";
		for (index in reportsList){
			reportsOptions = reportsOptions + part1 + reportsList[index] + part2 + reportsList[index] + part3;
		}
		document.getElementById("reportsList").innerHTML = repPrefix + repDummy + reportsOptions + repSuffix;
		
		// gets proc_ids from selected report
		function getProcIds(report){
			if(loadJSFile(report)){
				var procIds = new Array();
				procIds = _getProcList().split(",");
				var procOptions = "";
				for (index in procIds){
					procOptions = procOptions + part1 + procIds[index] + part2 + procIds[index].substring(1) + part3;
				}	
				document.getElementById("procsList").innerHTML = procPrefix + procDummy + procOptions + procSuffix;
			} else {
				document.getElementById("procsList").innerHTML = procPrefix + procFailed + procSuffix;
			}
		}
	</script>
</body>
</html>